#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≥—Ä—É–ø–ø—ã –ê–ù–¢–ò–õ–û–ü–ê —á–µ—Ä–µ–∑ PM2"
echo "=============================================="

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /home/user1/ContentBot

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ PM2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if ! command -v pm2 &> /dev/null; then
    echo "‚ùå PM2 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é..."
    npm install -g pm2
fi

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–≥–æ–≤ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p logs

# –ü—Ä–æ–≤–µ—Ä—è–µ–º .env —Ñ–∞–π–ª
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if [ ! -f ".env" ]; then
    echo "‚ùå .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
if ! grep -q "API_ID=" .env || ! grep -q "API_HASH=" .env; then
    echo "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç API_ID –∏–ª–∏ API_HASH –≤ .env —Ñ–∞–π–ª–µ!"
    exit 1
fi

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—Å–ª–∏ —É–∂–µ –∑–∞–ø—É—â–µ–Ω
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å..."
pm2 stop antilopa-search-monitor 2>/dev/null || true
pm2 delete antilopa-search-monitor 2>/dev/null || true

# –ó–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ PM2
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥..."
pm2 start ecosystem.config.js

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–∞:"
pm2 status

echo ""
echo "üìù –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:"
echo "pm2 logs antilopa-search-monitor     # –í—Å–µ –ª–æ–≥–∏"
echo "pm2 logs antilopa-search-monitor --lines 50  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫"

echo ""
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞:"
echo "pm2 stop antilopa-search-monitor"
echo "pm2 delete antilopa-search-monitor"

echo ""
echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥—Ä—É–ø–ø—ã –ê–ù–¢–ò–õ–û–ü–ê –∑–∞–ø—É—â–µ–Ω!"
echo "üí° –¢–µ–ø–µ—Ä—å –ø–∏—à–∏—Ç–µ –≤ –≥—Ä—É–ø–ø–µ: –ü–û–ò–°–ö –ü–û –¢–ï–õ–ï–ì–ï –≤–∞—à –∑–∞–ø—Ä–æ—Å"

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
pm2 save


