import axios from "axios";
import { stringify } from "querystring";
/**
 *
 * @param {string} url URL адрес запроса
 * @param {QueryStringifiable} parameters Параметры запроса
 * @param {Record<string, string>=} [headers={}] Заголовки запроса
 * @param {Agent} [agent] Агент запроса
 *
 * @return {Promise<any>} JSON в ответе
 */
async function fetch(url, parameters, headers = {}, agent) {
  return await axios
    .post(url, stringify(parameters), {
      headers: {
        "User-Agent": "yoomoney-sdk/1.5.5 (+https://npmjs.com/package/yoomoney-sdk)",
        ...headers,
        "Content-Type": "application/x-www-form-urlencoded",
        Accept: "application/json"
      },
      httpAgent: agent,
      httpsAgent: agent,
      responseType: "json"
    })
    .then((response) => response.data)
    .catch((error) =>
      axios.isAxiosError(error) && error.response
        ? error.response.data
        : Promise.reject(error)
    );
}
export { fetch };
