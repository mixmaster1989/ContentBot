#!/usr/bin/env node

/**
 * –ó–∞–ø—É—Å–∫ ContentBot —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–≤—ã–º –º–æ–¥—É–ª–µ–º
 * 
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é ContentBot —Å –Ω–æ–≤—ã–º –º–æ–¥—É–ª–µ–º –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
 * –∏ –≥—Ä—É–ø–ø Telegram, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "Telegram Google".
 */

require('dotenv').config();
const { ContentBotSearchEnhanced } = require('./core/contentbot-search-enhanced');
const path = require('path');
const fs = require('fs');

// –õ–æ–≥–æ—Ç–∏–ø –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—É—Å–∫–µ
console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë   ü§ñ ContentBot —Å –ø–æ–∏—Å–∫–æ–≤—ã–º –º–æ–¥—É–ª–µ–º "Telegram Google"        ‚ïë
‚ïë                                                              ‚ïë
‚ïë   üîç –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–æ–≤ –∏ –≥—Ä—É–ø–ø                        ‚ïë
‚ïë   üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ç—Ä–µ–Ω–¥—ã                                      ‚ïë
‚ïë   üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤                                     ‚ïë
‚ïë   üéØ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è                             ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
function checkEnvironment() {
  console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
  
  const requiredEnvVars = [
    'BOT_TOKEN',
    'API_ID', 
    'API_HASH',
    'MONTHLY_PRICE',
    'CHANNEL_SETUP_PRICE',
    'PREMIUM_PRICE'
  ];
  
  const missing = requiredEnvVars.filter(varName => !process.env[varName]);
  
  if (missing.length > 0) {
    console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:');
    missing.forEach(varName => console.error(`   - ${varName}`));
    console.error('\nüí° –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏');
    process.exit(1);
  }
  
  console.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
function checkDirectories() {
  console.log('üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π...');
  
  const requiredDirs = [
    './data',
    './logs',
    './core'
  ];
  
  for (let dir of requiredDirs) {
    if (!fs.existsSync(dir)) {
      console.log(`üìÅ –°–æ–∑–¥–∞—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: ${dir}`);
      fs.mkdirSync(dir, { recursive: true });
    }
  }
  
  console.log('‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≥–æ—Ç–æ–≤—ã');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
function checkDatabase() {
  console.log('üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
  
  const dbPath = './data/contentbot.db';
  if (!fs.existsSync(dbPath)) {
    console.log('üÜï –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ');
  } else {
    console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞');
  }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
function showAvailableCommands() {
  console.log(`
üéØ –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê:

üìù –ö–û–ù–¢–ï–ù–¢:
  /start        - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  /demo         - –î–µ–º–æ-–ø–æ—Å—Ç
  /order        - –ó–∞–∫–∞–∑–∞—Ç—å –∫–∞–Ω–∞–ª
  /channels     - –ú–æ–∏ –∫–∞–Ω–∞–ª—ã
  /analytics    - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø—Ä–µ–º–∏—É–º)

üîç –ü–û–ò–°–ö:
  /search <–∑–∞–ø—Ä–æ—Å>     - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
  /search_advanced     - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
  /search_category     - –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  /search_trends       - –¢—Ä–µ–Ω–¥–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
  /search_history      - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞
  /search_recommend    - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚öôÔ∏è –°–ò–°–¢–ï–ú–ê:
  /help         - –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞
  /status       - –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
  /feedback     - –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

üí° –ü–†–ò–ú–ï–†–´ –ü–û–ò–°–ö–ê:
  /search –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
  /search –Ω–æ–≤–æ—Å—Ç–∏ —Ä–æ—Å—Å–∏—è
  /search –∏–≥—Ä—ã steam
  /search –æ–±—É—á–µ–Ω–∏–µ python
`);
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö
function showSearchFeatures() {
  console.log(`
üîç –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –ü–û–ò–°–ö–û–í–û–ì–û –ú–û–î–£–õ–Ø:

üéØ –¢–ò–ü–´ –ü–û–ò–°–ö–ê:
  ‚Ä¢ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É Telegram
  ‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ 20+ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  ‚Ä¢ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
  ‚Ä¢ –ü–æ–∏—Å–∫ –≤ –∫–∞–Ω–∞–ª–∞—Ö-–∫–∞—Ç–∞–ª–æ–≥–∞—Ö
  ‚Ä¢ –ü–æ–∏—Å–∫ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

üìä –§–ò–õ–¨–¢–†–´:
  ‚Ä¢ –¢–∏–ø: –∫–∞–Ω–∞–ª—ã/–≥—Ä—É–ø–ø—ã/–≤—Å–µ
  ‚Ä¢ –†–∞–∑–º–µ—Ä: –æ—Ç –º–∏–Ω–∏–º—É–º–∞ –¥–æ –º–∞–∫—Å–∏–º—É–º–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  ‚Ä¢ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
  ‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ª—é–±–∞—è –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º–∞—Ç–∏–∫
  ‚Ä¢ –ù–∞–ª–∏—á–∏–µ username –¥–ª—è –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫

üíæ –≠–ö–°–ü–û–†–¢:
  ‚Ä¢ JSON - –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
  ‚Ä¢ CSV - –¥–ª—è —Ç–∞–±–ª–∏—Ü –∏ –∞–Ω–∞–ª–∏–∑–∞
  ‚Ä¢ Markdown - –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê:
  ‚Ä¢ –¢—Ä–µ–Ω–¥–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
  ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
`);
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞
async function startBot() {
  try {
    console.log('\nüöÄ –ó–∞–ø—É—Å–∫ ContentBot —Å –ø–æ–∏—Å–∫–æ–≤—ã–º –º–æ–¥—É–ª–µ–º...\n');
    
    // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
    checkEnvironment();
    checkDirectories(); 
    checkDatabase();
    
    console.log('ü§ñ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞...');
    
    // –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    const contentBot = new ContentBotSearchEnhanced();
    
    // Graceful shutdown
    process.once('SIGINT', async () => {
      console.log('\nüõë –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...');
      await contentBot.stop();
      process.exit(0);
    });
    
    process.once('SIGTERM', async () => {
      console.log('\nüõë –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...');
      await contentBot.stop();
      process.exit(0);
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
    process.on('unhandledRejection', (reason, promise) => {
      console.error('‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ Promise:', reason);
      console.error('   –í –ø—Ä–æ–º–∏—Å–µ:', promise);
    });
    
    process.on('uncaughtException', (error) => {
      console.error('‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:', error);
      process.exit(1);
    });
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    await contentBot.start();
    
    console.log('\nüéâ ContentBot —Å –ø–æ–∏—Å–∫–æ–≤—ã–º –º–æ–¥—É–ª–µ–º —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!');
    console.log('üì± –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ Telegram');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    showAvailableCommands();
    showSearchFeatures();
    
    console.log(`
üí° –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò:
  ‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ./SEARCH_MODULE_README.md
  ‚Ä¢ –î–µ–º–æ –ø–æ–∏—Å–∫–∞: node demo-search-functionality.js
  ‚Ä¢ –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã: ./logs/
  ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ./data/contentbot.db

üîß –î–õ–Ø –û–°–¢–ê–ù–û–í–ö–ò:
  ‚Ä¢ Ctrl+C –∏–ª–∏ Kill —Å–∏–≥–Ω–∞–ª
  ‚Ä¢ –ë–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

‚ö° –°–¢–ê–¢–£–°: –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –æ–∂–∏–¥–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã...
`);
    
  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:', error);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
if (require.main === module) {
  const args = process.argv.slice(2);
  
  if (args.includes('--help') || args.includes('-h')) {
    console.log(`
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: node start-search-enhanced.js [–æ–ø—Ü–∏–∏]

–û–ø—Ü–∏–∏:
  --help, -h     –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
  --demo         –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
  --status       –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –±–µ–∑ –∑–∞–ø—É—Å–∫–∞
  
–ü—Ä–∏–º–µ—Ä—ã:
  node start-search-enhanced.js                # –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
  node start-search-enhanced.js --demo         # –ó–∞–ø—É—Å–∫ –¥–µ–º–æ
  node start-search-enhanced.js --status       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
`);
    process.exit(0);
  }
  
  if (args.includes('--demo')) {
    console.log('üé¨ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è...');
    require('./demo-search-functionality.js');
    return;
  }
  
  if (args.includes('--status')) {
    console.log('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã...');
    checkEnvironment();
    checkDirectories();
    checkDatabase();
    console.log('‚úÖ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É');
    process.exit(0);
  }
  
  // –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
  startBot();
}

module.exports = { startBot };


